<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reze RP – Gemini 2.5 Pro</title>
  <link rel="stylesheet" href="styles.css?v=7" />
</head>
<body>
<div class="app" id="app">
  <header>
    <h1>Reze RP <span class="pill">Gemini 2.5 Pro • GitHub Pages</span></h1>
    <div class="row">
      <button class="btn" id="newChat">새 대화</button>
      <button class="btn" id="exportChat">대화 내보내기</button>
      <input id="importChatFile" type="file" accept="application/json" style="display:none" />
      <button class="btn" id="importChat">가져오기</button>
    </div>
  </header>

  <!-- Tabs -->
  <nav class="tabs">
    <button class="tab active" data-tab="chat">채팅</button>
    <button class="tab" data-tab="editor">프롬프트·월드·캐릭터</button>
    <button class="tab" data-tab="gallery">이미지 갤러리</button>
  </nav>

  <!-- Page 1: Chat -->
  <section class="page chat-grid active" id="page_chat">
    <div class="mini-conn">
      <span class="tag">API Key</span>
      <input id="miniApiKey" type="password" placeholder="AIza..." />
      <span class="tag">Model</span>
      <input id="miniModel" type="text" value="gemini-2.5-pro" />
      <button class="btn" id="miniSave">저장</button>
      <button class="btn" id="miniTest">테스트</button>
      <div class="muted" id="miniState"></div>
    </div>

    <div id="chat"></div>

    <div class="composer">
      <div class="bar">
        <textarea id="userInput" placeholder="레제에게 말하기... Shift+Enter 줄바꿈"></textarea>
        <div class="stack">
          <button class="btn accent" id="send">보내기 ⏎</button>
          <button class="btn danger" id="stop">중지</button>
        </div>
      </div>
      <div class="muted" style="margin-top:6px">키는 브라우저 로컬에만 저장됩니다. 하드코딩 금지.</div>
    </div>
  </section>

  <!-- Page 2: Editor -->
  <section class="page panel" id="page_editor">
    <div class="card">
      <h3>시스템 프롬프트(고정)</h3>
      <textarea id="systemPrompt" placeholder="예: 응답 첫 줄에 <emotion:...> 1개 포함."></textarea>
      <label><input type="checkbox" id="lockSystem"> 대화마다 자동주입</label>
    </div>
    <div class="card">
      <h3>월드 정보(고정)</h3>
      <textarea id="worldInfo" placeholder="체인소맨 세계관, 시간대, 인물관계 등"></textarea>
      <label><input type="checkbox" id="lockWorld"> 대화마다 자동주입</label>
    </div>
    <div class="card">
      <h3>캐릭터(레제) 지침</h3>
      <label>이름</label><input id="charName" type="text" value="레제" />
      <label>캐릭터 프롬프트</label>
      <textarea id="charPrompt" placeholder="레제의 성격·말버릇·금지어·롤플 규칙"></textarea>
      <label><input type="checkbox" id="lockChar"> 대화마다 자동주입</label>
    </div>

    <div class="card">
      <h3>감정 매핑(JSON)</h3>
      <p class="muted">예: 
</p>
      <textarea id="emotionMap"></textarea>
      <div class="row" style="margin-top:8px"><button class="btn" id="saveLore">저장</button></div>
    </div>

    <div class="card" style="grid-column:1 / -1">
      <h3>아바타</h3>
      <label>사용자 아바타 URL (기본: assets/reze/profile/user.png)</label>
      <input id="userAvatar" type="text" placeholder="assets/reze/profile/user.png" />
      <label>레제 아바타 URL (기본: assets/reze/profile/reze.png)</label>
      <input id="assistantAvatar" type="text" placeholder="assets/reze/profile/reze.png" />
      <div class="row" style="margin-top:8px"><button class="btn" id="saveAvatars">아바타 저장</button></div>
    </div>

    <div class="card" style="grid-column:1 / -1">
      <h3>첫 메시지(그리팅)</h3>
      <label>문구</label>
      <textarea id="greetingText" placeholder="예: <emotion:happy> 안녕! 난 레제."></textarea>
      <label><input type="checkbox" id="greetingOn"> 새 대화 시작 시 자동 표시</label>
      <div class="row" style="margin-top:8px"><button class="btn" id="saveGreeting">그리팅 저장</button></div>
    </div>
  </section>

  <!-- Page 3: Gallery + BGM -->
  <section class="page panel" id="page_gallery">
    <div class="card" style="grid-column:1 / -1">
      <h3>이미지 갤러리</h3>
      <p class="muted">
        권장: <code>assets/reze/manifest.json</code> (문자열 배열 또는 객체 배열).<br>
        예: <code>["reze_happy.gif","reze_angry.gif"]</code> 또는 <code>[{"src":"reze_happy.gif","tag":"happy"}]</code>
      </p>
      <div class="row">
        <input id="assetsBase" type="text" placeholder="assets/reze" value="assets/reze" />
        <input id="manifestPath" type="text" placeholder="assets/reze/manifest.json" value="assets/reze/manifest.json" />
        <button class="btn" id="reload">갤러리 새로고침</button>
      </div>
      <div id="gallery" class="gallery" style="margin-top:10px"></div>
    </div>

    <div class="card" style="grid-column:1 / -1">
      <h3>BGM</h3>
      <p class="muted">MP3를 <code>assets/bgm/track.mp3</code>로 넣으면 자동재생 시도. 막히면 우하단 버튼 표시.</p>
      <label>URL (고정)</label>
      <input id="bgmUrl" type="text" value="assets/bgm/track.mp3" readonly />
      <div class="row" style="margin-top:8px">
        <label style="display:flex;align-items:center;gap:6px"><input type="checkbox" id="bgmLoop" checked/> 반복</label>
        <input id="bgmVol" type="range" min="0" max="1" step="0.01" class="range" style="flex:1" value="0.4"/>
        <button class="btn" id="bgmPlay">재생/일시정지</button>
      </div>
      <audio id="bgmAudio" preload="auto" playsinline></audio>
    </div>
  </section>
</div>

<!-- Lightbox -->
<div id="lightbox" class="lightbox" aria-modal="true" role="dialog">
  <div class="frame">
    <header>
      <div class="title" id="lightboxTitle"></div>
      <button class="btn" id="lightboxClose">닫기</button>
    </header>
    <div class="body"><img id="lightboxImg" alt="preview"></div>
  </div>
</div>

<!-- Autoplay fallback button -->
<button id="bgmUnmute" class="floating" style="display:none">🔊 BGM 켜기</button>

<script src="app.js?v=7"></script>
</body>
</html>
